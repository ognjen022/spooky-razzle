{"ast":null,"code":"var _jsxFileName = \"/Users/ognjen/Desktop/with-typescript/src/components/SubscriptionsDetails/SubscriptionsDetails.tsx\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport styles from './SubscriptionsDetails.module.scss';\nimport * as _ from 'lodash';\nimport moment from 'moment';\nimport { selectStreamByLivestreamEventId } from '../../services/content/tags/selectors';\nimport { selectGamePassPriceFormatted, selectWatchItAllPriceFormatted } from '../../services/payments/products/selectors';\nimport { Link } from 'react-router-dom';\nimport { unsubscribeRequestedEvent } from '../../services/payments/subscriptions/events';\nimport { selectProducts } from '../../services/config/selectors';\n\nconst SubscriptionsDetails = props => {\n  const purchaseHistoryItems = _.cloneDeep(useSelector(state => {\n    var _state$payments, _state$payments$subsc;\n\n    return ((_state$payments = state.payments) === null || _state$payments === void 0 ? void 0 : (_state$payments$subsc = _state$payments.subscriptions) === null || _state$payments$subsc === void 0 ? void 0 : _state$payments$subsc.items) || [];\n  }));\n\n  const streams = useSelector(state => state.content.tags.streams || []);\n  const uuidIndex = useSelector(state => state.content.tags.uuidIndex || []);\n  const tags = uuidIndex.map(index => index.tag);\n  const stripeWatchItAllProductId = useSelector(state => {\n    var _selectProducts$watch;\n\n    return (_selectProducts$watch = selectProducts(state.configuration).watch_it_all) !== null && _selectProducts$watch !== void 0 ? _selectProducts$watch : '';\n  });\n  const gamePassPriceFormatted = useSelector(state => {\n    var _state$payments2;\n\n    return selectGamePassPriceFormatted((_state$payments2 = state.payments) === null || _state$payments2 === void 0 ? void 0 : _state$payments2.products, state.configuration);\n  });\n  const watchItAllPriceFormatted = useSelector(state => {\n    var _state$payments3;\n\n    return selectWatchItAllPriceFormatted((_state$payments3 = state.payments) === null || _state$payments3 === void 0 ? void 0 : _state$payments3.products, state.configuration);\n  });\n  const dispatch = useDispatch();\n\n  const onUnsubscribe = () => {\n    dispatch(unsubscribeRequestedEvent());\n  };\n\n  purchaseHistoryItems === null || purchaseHistoryItems === void 0 ? void 0 : purchaseHistoryItems.forEach(purchaseHistoryItem => {\n    // item.product_id === tag.stripeProductId ? item = { ...item, tagName: tag.name } : item\n    const matches = tags.filter(tag => tag.stripeProductId === purchaseHistoryItem.product_id);\n\n    if (purchaseHistoryItem.product_id === stripeWatchItAllProductId) {\n      purchaseHistoryItem.tagName = 'Watch It All';\n      purchaseHistoryItem.price = `${watchItAllPriceFormatted}/month`;\n    } else if (matches && matches.length > 0) {\n      purchaseHistoryItem.tagName = matches[0].name;\n      purchaseHistoryItem.price = '$29.95';\n    }\n\n    if (purchaseHistoryItem.subscriptionType === 'GamePass') {\n      var _purchaseHistoryItem$;\n\n      let livestreamEventId = (_purchaseHistoryItem$ = purchaseHistoryItem.product_id) === null || _purchaseHistoryItem$ === void 0 ? void 0 : _purchaseHistoryItem$.split('|')[0];\n      let match = selectStreamByLivestreamEventId(streams, livestreamEventId || '');\n      purchaseHistoryItem.tagName = (match === null || match === void 0 ? void 0 : match.name) || 'Game Pass (unknown)';\n      purchaseHistoryItem.price = gamePassPriceFormatted;\n    }\n  }); // tableData.pop()\n\n  return __jsx(\"table\", {\n    className: styles['subscriptions-details-table'],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 5\n    }\n  }, __jsx(\"thead\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }\n  }, __jsx(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 9\n    }\n  }, __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 11\n    }\n  }, \"Name\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 11\n    }\n  }, \"Purchased\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 11\n    }\n  }, \"Price\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 11\n    }\n  }, \"Expiry\"))), __jsx(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }\n  }, purchaseHistoryItems === null || purchaseHistoryItems === void 0 ? void 0 : purchaseHistoryItems.map((item, index) => __jsx(\"tr\", {\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 11\n    }\n  }, __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 13\n    }\n  }, item.tagName), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }\n  }, moment(item.start).format('L')), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 13\n    }\n  }, item.price), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 13\n    }\n  }, item.subscriptionType === 'WatchItAll' && item.expiry !== 'Cancelled' && __jsx(Link, {\n    to: \"#\",\n    onClick: onUnsubscribe,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 17\n    }\n  }, item.expiry), (item.subscriptionType !== 'WatchItAll' || item.subscriptionType === 'WatchItAll' && item.expiry === 'Cancelled') && item.expiry)))));\n};\n\nexport default SubscriptionsDetails;","map":{"version":3,"sources":["/Users/ognjen/Desktop/with-typescript/src/components/SubscriptionsDetails/SubscriptionsDetails.tsx"],"names":["React","useDispatch","useSelector","styles","_","moment","selectStreamByLivestreamEventId","selectGamePassPriceFormatted","selectWatchItAllPriceFormatted","Link","unsubscribeRequestedEvent","selectProducts","SubscriptionsDetails","props","purchaseHistoryItems","cloneDeep","state","payments","subscriptions","items","streams","content","tags","uuidIndex","map","index","tag","stripeWatchItAllProductId","configuration","watch_it_all","gamePassPriceFormatted","products","watchItAllPriceFormatted","dispatch","onUnsubscribe","forEach","purchaseHistoryItem","matches","filter","stripeProductId","product_id","tagName","price","length","name","subscriptionType","livestreamEventId","split","match","item","start","format","expiry"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport styles from './SubscriptionsDetails.module.scss'\nimport { RootState } from '../../services/RootState'\nimport { SubscriptionDetailsState, PurchaseHistory } from '../../services/payments/subscriptions/models'\nimport { ITag, ITagIndex, IStream } from '../../services/content/tags/models'\nimport * as _ from 'lodash'\nimport moment from 'moment'\nimport { selectSavedStreams, selectStreamByLivestreamEventId } from '../../services/content/tags/selectors'\nimport { selectGamePassPriceFormatted, selectWatchItAllPriceFormatted } from '../../services/payments/products/selectors'\nimport { Link } from 'react-router-dom'\nimport { unsubscribeRequestedEvent } from '../../services/payments/subscriptions/events'\nimport { selectProducts } from '../../services/config/selectors'\n\ninterface ISubscriptionsDetailsProps {\n\n}\n\nconst SubscriptionsDetails: React.FC<ISubscriptionsDetailsProps> = (props) => {\n\n  const purchaseHistoryItems = _.cloneDeep(useSelector<RootState, PurchaseHistory[]>(state => state.payments?.subscriptions?.items || []))\n  const streams = useSelector<RootState, IStream[]>(state => state.content.tags.streams || [])\n  const uuidIndex = useSelector<RootState, ITagIndex[]>(state => state.content.tags.uuidIndex || [])\n  const tags = uuidIndex.map(index => index.tag)\n  const stripeWatchItAllProductId = useSelector<RootState, string>(state => selectProducts(state.configuration).watch_it_all ?? '');\n  const gamePassPriceFormatted = useSelector<RootState, string>(state => selectGamePassPriceFormatted(state.payments?.products, state.configuration))\n  const watchItAllPriceFormatted = useSelector<RootState, string>(state => selectWatchItAllPriceFormatted(state.payments?.products, state.configuration))\n\n\n  const dispatch = useDispatch();\n  const onUnsubscribe = () => {\n    dispatch(unsubscribeRequestedEvent())\n  }\n  purchaseHistoryItems?.forEach((purchaseHistoryItem: PurchaseHistory) => {\n    // item.product_id === tag.stripeProductId ? item = { ...item, tagName: tag.name } : item\n    const matches = tags.filter(tag => tag.stripeProductId === purchaseHistoryItem.product_id)\n    if (purchaseHistoryItem.product_id === stripeWatchItAllProductId) {\n      purchaseHistoryItem.tagName = 'Watch It All'\n      purchaseHistoryItem.price = `${watchItAllPriceFormatted}/month`\n    } else if (matches && matches.length > 0) {\n      purchaseHistoryItem.tagName = matches[0].name\n      purchaseHistoryItem.price = '$29.95'\n    }\n\n    if (purchaseHistoryItem.subscriptionType === 'GamePass') {\n\n      let livestreamEventId = purchaseHistoryItem.product_id?.split('|')[0]\n\n      let match = selectStreamByLivestreamEventId(streams, livestreamEventId || '')\n      purchaseHistoryItem.tagName = match?.name || 'Game Pass (unknown)'\n      purchaseHistoryItem.price = gamePassPriceFormatted\n    }\n  })\n\n  // tableData.pop()\n\n  return (\n    <table className={styles['subscriptions-details-table']}>\n      <thead>\n        <tr>\n          <th>Name</th>\n          <th>Purchased</th>\n          <th>Price</th>\n          <th>Expiry</th>\n        </tr>\n      </thead>\n      <tbody>\n        {purchaseHistoryItems?.map((item: PurchaseHistory, index) =>\n          <tr key={index}>\n            <td>{item.tagName}</td>\n            <td>{moment(item.start).format('L')}</td>\n            <td>{item.price}</td>\n            <td>\n              {(item.subscriptionType === 'WatchItAll' && item.expiry !== 'Cancelled') &&\n                <Link to='#' onClick={onUnsubscribe}>{item.expiry}</Link>\n              }\n              {(item.subscriptionType !== 'WatchItAll' || (item.subscriptionType === 'WatchItAll' && item.expiry === 'Cancelled')) &&\n                item.expiry\n              }\n            </td>\n          </tr>)}\n      </tbody>\n    </table>\n\n  )\n}\n\nexport default SubscriptionsDetails\n"]},"metadata":{},"sourceType":"module"}