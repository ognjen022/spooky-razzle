{"ast":null,"code":"import { from, of, EMPTY } from 'rxjs';\nimport { exhaustMap, filter, catchError } from 'rxjs/operators';\nimport { isActionOf } from 'typesafe-actions';\nimport { tagsSaveTagEvent } from '../events';\nimport Notifications from 'react-notification-system-redux';\nimport { postOrDeleteSavedTags } from '../api/postOrDeleteSavedTags';\n\nconst getErrorNotification = method => {\n  return Notifications.error({\n    title: 'Error',\n    message: `An error occurred. Tag not ${method.toLocaleLowerCase().replace('delete', 'delet')}ed. Please try again.`,\n    position: 'tc',\n    autoDismiss: 10,\n    action: {\n      label: 'Close',\n      callback: () => console.log('Notification closed')\n    }\n  });\n};\n\nconst tagsSaveRequestedEpic = (action$, state$) => action$.pipe(filter(isActionOf(tagsSaveTagEvent)), exhaustMap(event => {\n  const tagId = event.payload;\n  let method = 'POST';\n  if (!state$.value.content.tags.savedTagIds.includes(tagId)) method = 'DELETE';\n  return from(postOrDeleteSavedTags(tagId, method)).pipe(exhaustMap(apiResponse => {\n    if (apiResponse.is_success) {\n      return EMPTY;\n    }\n\n    return of(getErrorNotification(method));\n  }), catchError(() => of(getErrorNotification(method))));\n}));\n\nexport default [tagsSaveRequestedEpic];","map":{"version":3,"sources":["/Users/ognjen/Desktop/with-typescript/src/services/content/tags/epics/saveTagRequestedEpic.ts"],"names":["from","of","EMPTY","exhaustMap","filter","catchError","isActionOf","tagsSaveTagEvent","Notifications","postOrDeleteSavedTags","getErrorNotification","method","error","title","message","toLocaleLowerCase","replace","position","autoDismiss","action","label","callback","console","log","tagsSaveRequestedEpic","action$","state$","pipe","event","tagId","payload","value","content","tags","savedTagIds","includes","apiResponse","is_success"],"mappings":"AACA,SAASA,IAAT,EAAeC,EAAf,EAAmBC,KAAnB,QAAgC,MAAhC;AACA,SAASC,UAAT,EAAqBC,MAArB,EAA6BC,UAA7B,QAA+C,gBAA/C;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,gBAAT,QAAiC,WAAjC;AAEA,OAAOC,aAAP,MAA0B,iCAA1B;AACA,SAASC,qBAAT,QAAsC,8BAAtC;;AAEA,MAAMC,oBAAoB,GAAIC,MAAD,IAAoB;AAC/C,SAAOH,aAAa,CAACI,KAAd,CACL;AACEC,IAAAA,KAAK,EAAE,OADT;AAEEC,IAAAA,OAAO,EAAG,8BAA6BH,MAAM,CAACI,iBAAP,GAA2BC,OAA3B,CAAmC,QAAnC,EAA6C,OAA7C,CAAsD,uBAF/F;AAGEC,IAAAA,QAAQ,EAAE,IAHZ;AAIEC,IAAAA,WAAW,EAAE,EAJf;AAKEC,IAAAA,MAAM,EAAE;AACNC,MAAAA,KAAK,EAAE,OADD;AAENC,MAAAA,QAAQ,EAAE,MAAMC,OAAO,CAACC,GAAR,CAAY,qBAAZ;AAFV;AALV,GADK,CAAP;AAYD,CAbD;;AAgBA,MAAMC,qBAAgD,GAAG,CAACC,OAAD,EAAUC,MAAV,KACvDD,OAAO,CAACE,IAAR,CACEvB,MAAM,CAACE,UAAU,CAACC,gBAAD,CAAX,CADR,EAEEJ,UAAU,CAAEyB,KAAD,IAAgB;AACzB,QAAMC,KAAa,GAAGD,KAAK,CAACE,OAA5B;AACA,MAAInB,MAAc,GAAG,MAArB;AACA,MAAI,CAACe,MAAM,CAACK,KAAP,CAAaC,OAAb,CAAqBC,IAArB,CAA0BC,WAA1B,CAAsCC,QAAtC,CAA+CN,KAA/C,CAAL,EAA4DlB,MAAM,GAAG,QAAT;AAE5D,SAAOX,IAAI,CAACS,qBAAqB,CAACoB,KAAD,EAAQlB,MAAR,CAAtB,CAAJ,CAA2CgB,IAA3C,CACLxB,UAAU,CAACiC,WAAW,IAAI;AACxB,QAAIA,WAAW,CAACC,UAAhB,EAA4B;AAC1B,aAAOnC,KAAP;AACD;;AAED,WAAOD,EAAE,CAACS,oBAAoB,CAACC,MAAD,CAArB,CAAT;AACD,GANS,CADL,EAQLN,UAAU,CAAC,MAAMJ,EAAE,CAACS,oBAAoB,CAACC,MAAD,CAArB,CAAT,CARL,CAAP;AAUD,CAfS,CAFZ,CADF;;AAqBA,eAAe,CAACa,qBAAD,CAAf","sourcesContent":["import { Epic } from 'redux-observable'\nimport { from, of, EMPTY } from 'rxjs'\nimport { exhaustMap, filter, catchError } from 'rxjs/operators'\nimport { isActionOf } from 'typesafe-actions'\nimport { tagsSaveTagEvent } from '../events'\nimport { RootState } from '../../../RootState'\nimport Notifications from 'react-notification-system-redux'\nimport { postOrDeleteSavedTags } from '../api/postOrDeleteSavedTags'\n\nconst getErrorNotification = (method: string) => {\n  return Notifications.error(\n    {\n      title: 'Error',\n      message: `An error occurred. Tag not ${method.toLocaleLowerCase().replace('delete', 'delet')}ed. Please try again.`,\n      position: 'tc',\n      autoDismiss: 10,\n      action: {\n        label: 'Close',\n        callback: () => console.log('Notification closed')\n      }\n    }\n  )\n}\n\n\nconst tagsSaveRequestedEpic: Epic<any, any, RootState> = (action$, state$) =>\n  action$.pipe(\n    filter(isActionOf(tagsSaveTagEvent)),\n    exhaustMap((event: any) => {\n      const tagId: string = event.payload\n      let method: string = 'POST'\n      if (!state$.value.content.tags.savedTagIds.includes(tagId)) method = 'DELETE'\n\n      return from(postOrDeleteSavedTags(tagId, method)).pipe(\n        exhaustMap(apiResponse => {\n          if (apiResponse.is_success) {\n            return EMPTY\n          }\n\n          return of(getErrorNotification(method))\n        }),\n        catchError(() => of(getErrorNotification(method)))\n      )\n    })\n  )\n\nexport default [tagsSaveRequestedEpic]\n"]},"metadata":{},"sourceType":"module"}