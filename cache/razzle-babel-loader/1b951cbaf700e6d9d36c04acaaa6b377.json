{"ast":null,"code":"import _objectSpread from \"/Users/ognjen/Desktop/with-typescript/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"/Users/ognjen/Desktop/with-typescript/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/ognjen/Desktop/with-typescript/src/scenes/Payment/PaymentNew.tsx\",\n    _this = this;\n\nvar __jsx = React.createElement;\nimport _regeneratorRuntime from \"/Users/ognjen/Desktop/with-typescript/node_modules/@babel/runtime/regenerator\";\nimport React, { useEffect, useState } from \"react\";\nimport _ from \"lodash\";\nimport { useForm, useField } from \"react-final-form-hooks\";\nimport { CardNumberElement, CardCvcElement, CardExpiryElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport * as eventTypes from \"../../services/payments/paymentDetails/eventTypes\";\nimport styles from \"./Payment.module.scss\";\nimport PromoCode from \"../../components/PromoCode/PromoCode\";\nimport Input from \"../../components/Input/Input\";\nimport Button from \"../../components/Button/Button\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { purchaseTagRequestedEvent, purchaseWatchItAllRequestedEvent, showPurchaseModalToggledEvent, purchaseGamePassRequestedEvent, promoRequestedEvent } from \"../../services/payments/purchase/events\";\nimport { PurchaseOption } from \"../../services/payments/purchase/models\";\nimport { push } from \"connected-react-router\";\nimport { selectGamePassPriceFormatted, selectWatchItAllPriceFormatted, selectSeasonPassPriceFormatted } from \"../../services/payments/products/selectors\";\nimport { isGamePass, isSeasonPass, selectPromoCode } from \"../../services/payments/purchase/selectors\";\nimport moment from \"moment\";\nimport Product, { productColor } from \"../../components/Product/Product\";\nimport { Link } from \"react-router-dom\";\nimport { selectTag } from \"../../services/content/tags/selectors\";\nimport { StreamTypes } from \"../../services/content/tags/models\";\nvar ELEMENT_OPTIONS = {\n  style: {\n    base: {\n      fontFamily: \"Modern Era, sans-serif\",\n      fontSize: \"13px\",\n      backgroundColor: \"transparent\",\n      color: \"#F5F5F5\",\n      lineHeight: \"auto\"\n    },\n    invalid: {\n      color: \"#e82e06\"\n    }\n  }\n};\n\nvar validate = function validate(values) {\n  var errors = {\n    promoCode: undefined,\n    cardName: undefined,\n    cardNumber: undefined,\n    ccv: undefined,\n    expiry: undefined\n  };\n  return errors;\n};\n\nvar PaymentNew = function PaymentNew(props) {\n  var elements = useElements();\n  var stripe = useStripe();\n\n  var _useState = useState(\"\"),\n      nameOnCard = _useState[0];\n\n  var _useState2 = useState(\"\"),\n      postal = _useState2[0];\n\n  var _useState3 = useState(\"\"),\n      errorMessage = _useState3[0],\n      setErrorMessage = _useState3[1];\n\n  var _useState4 = useState(null),\n      setPaymentMethod = _useState4[1]; // Initial values form\n\n\n  var initialValues = {\n    promoCode: undefined,\n    cardName: undefined,\n    cardNumber: undefined,\n    ccv: undefined,\n    expiry: undefined\n  };\n\n  var onSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(payload) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var _useForm = useForm({\n    onSubmit: onSubmit,\n    validate: validate,\n    initialValues: initialValues\n  }),\n      form = _useForm.form;\n\n  var watchItAllPriceFormatted = useSelector(function (state) {\n    var _state$payments;\n\n    return selectWatchItAllPriceFormatted((_state$payments = state.payments) === null || _state$payments === void 0 ? void 0 : _state$payments.products, state.configuration);\n  });\n  var gamePassPriceFormatted = useSelector(function (state) {\n    var _state$payments2;\n\n    return selectGamePassPriceFormatted((_state$payments2 = state.payments) === null || _state$payments2 === void 0 ? void 0 : _state$payments2.products, state.configuration);\n  });\n  var seasonPassPriceFormatted = useSelector(function (state) {\n    return selectSeasonPassPriceFormatted(state);\n  });\n  var gamePassSelected = useSelector(function (state) {\n    return isGamePass(state.payments.purchase);\n  });\n  var seasonPassSelected = useSelector(function (state) {\n    return isSeasonPass(state.payments.purchase);\n  });\n  var name = useSelector(function (state) {\n    var _state$userSecurity, _state$userSecurity$p;\n\n    return ((_state$userSecurity = state.userSecurity) === null || _state$userSecurity === void 0 ? void 0 : (_state$userSecurity$p = _state$userSecurity.profile) === null || _state$userSecurity$p === void 0 ? void 0 : _state$userSecurity$p.name) || \"\";\n  });\n  var isSaving = useSelector(function (state) {\n    return state.payments.purchase.isSaving;\n  });\n  var promo = useSelector(function (state) {\n    return selectPromoCode(state.payments.purchase);\n  });\n  var promoCode = useField(\"promoCode\", form);\n  var tag = useSelector(function (state) {\n    return selectTag(state, state.payments.purchase.tagId);\n  });\n\n  promoCode.input.onBlur = function (e) {\n    var price = getPresetPrice().replace(/^[$*]/g, \"\");\n    dispatch(promoRequestedEvent(promoCode.input.value, price));\n  };\n\n  var streams = useSelector(function (state) {\n    return state.content.tags.streams;\n  });\n\n  var stream = _.find(streams || [], function (stream) {\n    return stream.eventId === props.eventId;\n  });\n\n  var _useState5 = useState(),\n      total = _useState5[0],\n      setTotal = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      computeTrial = _useState6[0],\n      calculateTrial = _useState6[1];\n\n  var _useState7 = useState(PurchaseOption.WatchItAll),\n      purchaseOption = _useState7[0],\n      setPurchaseOption = _useState7[1];\n\n  var _useState8 = useState(\"\\xA0\"),\n      description = _useState8[0],\n      setDescription = _useState8[1];\n\n  var dispatch = useDispatch();\n\n  var continueFree = function continueFree() {\n    dispatch(showPurchaseModalToggledEvent(undefined, undefined, undefined));\n    push(\"/browse\");\n  };\n\n  var getPresetPrice = function getPresetPrice() {\n    if (gamePassSelected) return gamePassPriceFormatted;else if (seasonPassSelected) return seasonPassPriceFormatted;else return watchItAllPriceFormatted;\n  };\n\n  useEffect(function () {\n    setTotal(getPresetPrice());\n\n    if (gamePassSelected) {\n      var videoStream = stream === null || stream === void 0 ? void 0 : stream.videoStreams.filter(function (stream) {\n        return stream.streamType === StreamTypes.MatchStream;\n      })[0].streamName;\n      setPurchaseOption(PurchaseOption.GamePass);\n      setDescription(videoStream !== null && videoStream !== void 0 ? videoStream : \"\\xA0\");\n    } else if (seasonPassSelected) {\n      var _tag$name;\n\n      setPurchaseOption(PurchaseOption.SeasonPass);\n      setDescription((_tag$name = tag === null || tag === void 0 ? void 0 : tag.name) !== null && _tag$name !== void 0 ? _tag$name : \"*Season Passes may vary in price\");\n    } else {\n      setPurchaseOption(PurchaseOption.WatchItAll);\n    }\n\n    var daysAfter = moment(new Date()).add(30, \"days\");\n    calculateTrial(\"\".concat(daysAfter.format(\"DD.MM.YYYY\")));\n  }, []);\n  useEffect(function () {\n    var _promo$nextPayment;\n\n    var daysAfter = moment(new Date()).add(30, \"days\");\n    calculateTrial((_promo$nextPayment = promo === null || promo === void 0 ? void 0 : promo.nextPayment) !== null && _promo$nextPayment !== void 0 ? _promo$nextPayment : \"\".concat(daysAfter.format(\"DD.MM.YYYY\")));\n\n    if (promo === null || promo === void 0 ? void 0 : promo.priceAfter) {\n      var _promo$priceAfter;\n\n      setTotal(\"$\".concat((parseFloat((_promo$priceAfter = promo === null || promo === void 0 ? void 0 : promo.priceAfter) !== null && _promo$priceAfter !== void 0 ? _promo$priceAfter : \"0\") / 100).toFixed(2)));\n    } else {\n      setTotal(getPresetPrice());\n    }\n  }, [promo]);\n\n  var handleSubmit2 = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event) {\n      var cardElement, token, payload;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              event.preventDefault();\n\n              if (!(!stripe || !elements)) {\n                _context2.next = 3;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 3:\n              cardElement = elements.getElement(CardNumberElement);\n              _context2.prev = 4;\n              _context2.next = 7;\n              return stripe.createToken(cardElement);\n\n            case 7:\n              token = _context2.sent;\n              dispatch({\n                type: [eventTypes.PAYMENTS_PAYMENT_DETAILS_RECEIVED],\n                payload: token\n              });\n              _context2.next = 14;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](4);\n              dispatch({\n                type: [eventTypes.PAYMENTS_PAYMENT_DETAILS_ERRORED],\n                payload: _context2.t0\n              });\n\n            case 14:\n              _context2.next = 16;\n              return stripe.createPaymentMethod({\n                type: \"card\",\n                card: cardElement,\n                billing_details: {\n                  name: name,\n                  address: {\n                    postal_code: postal\n                  }\n                }\n              });\n\n            case 16:\n              payload = _context2.sent;\n\n              if (!payload.error) {\n                _context2.next = 23;\n                break;\n              }\n\n              console.log(\"Payment.tsx [error]\", payload.error);\n              setErrorMessage(payload.error.message);\n              setPaymentMethod(null);\n              _context2.next = 34;\n              break;\n\n            case 23:\n              setPaymentMethod(payload.paymentMethod);\n              _context2.t1 = purchaseOption;\n              _context2.next = _context2.t1 === PurchaseOption.WatchItAll ? 27 : _context2.t1 === PurchaseOption.SeasonPass ? 29 : _context2.t1 === PurchaseOption.GamePass ? 31 : 33;\n              break;\n\n            case 27:\n              dispatch(purchaseWatchItAllRequestedEvent(promoCode.input.value, payload));\n              return _context2.abrupt(\"break\", 33);\n\n            case 29:\n              // console.log(payload);\n              dispatch(purchaseTagRequestedEvent(payload));\n              return _context2.abrupt(\"break\", 33);\n\n            case 31:\n              dispatch(purchaseGamePassRequestedEvent(payload));\n              return _context2.abrupt(\"break\", 33);\n\n            case 33:\n              setErrorMessage(\"\");\n\n            case 34:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[4, 11]]);\n    }));\n\n    return function handleSubmit2(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    className: styles[\"payment-new\"],\n    onClick: function onClick(e) {\n      return e.stopPropagation();\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: styles[\"payment-new__content\"],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: styles[\"payment-new__pricing-details\"],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 9\n    }\n  }, __jsx(\"p\", {\n    className: styles[\"payment-new__header\"],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 11\n    }\n  }, \"Plan details\"), purchaseOption === PurchaseOption.GamePass && __jsx(Product, {\n    description: description,\n    features: [\"Watch a events live\", \"Watch unlimited on demand\", \"Watch on any device\"],\n    onModal: true,\n    color: productColor.green,\n    showPurchaseButton: false,\n    title: \"Game Pass\",\n    price: \"\".concat(gamePassPriceFormatted),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 13\n    }\n  }), purchaseOption === PurchaseOption.SeasonPass && __jsx(Product, {\n    description: description,\n    features: [\"Watch any event live from your selected season\", \"Watch unlimited on demand\", \"Watch on any device\"],\n    onModal: true,\n    color: productColor.green,\n    showPurchaseButton: false,\n    title: \"Season Pass\",\n    price: \"\".concat(seasonPassPriceFormatted),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 13\n    }\n  }), purchaseOption === PurchaseOption.WatchItAll && __jsx(Product, {\n    description: \"Monthly Subscription\",\n    features: [\"Watch all events live\", \"Includes all competitions\", \"No fixed term contracts\", \"Watch unlimited on demand\", \"Watch on any device\"],\n    onModal: true,\n    color: productColor.green,\n    showPurchaseButton: false,\n    title: \"Watch It All\",\n    price: \"\".concat(watchItAllPriceFormatted, \" / Month\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 13\n    }\n  })), __jsx(\"div\", {\n    className: styles[\"payment-new__payment-details\"],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 9\n    }\n  }, __jsx(\"p\", {\n    className: styles[\"payment-new__header\"],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 11\n    }\n  }, \"Payment details\"), __jsx(\"form\", {\n    onSubmit: handleSubmit2,\n    className: styles[\"payment-new__form\"],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 11\n    }\n  }, __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 327,\n      columnNumber: 13\n    }\n  }, __jsx(Input, {\n    data: nameOnCard,\n    placeholder: \"Name on card\",\n    label: \"cardName\",\n    type: \"text\",\n    required: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 15\n    }\n  })), __jsx(\"div\", {\n    className: styles[\"payment-new__form-group\"],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 15\n    }\n  }, __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 17\n    }\n  }, __jsx(CardNumberElement, {\n    id: \"cardNumber\",\n    className: styles[\"payment-new__input\"]\n    /*onBlur={() => console.log('CardCvcElement blur')}\n                        onChange={() => console.log('CardCvcElement change')}\n                        onFocus={() => console.log('CardCvcElement focus')}\n                        onReady={() => console.log('CardCvcElement ready')}*/\n    ,\n    options: _objectSpread(_objectSpread({}, ELEMENT_OPTIONS), {}, {\n      placeholder: \"Credit card number \"\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 19\n    }\n  })), __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 17\n    }\n  }, __jsx(CardExpiryElement, {\n    id: \"expiry\",\n    className: styles[\"payment-new__input\"]\n    /*onBlur={() => console.log('CardExpiryElement blur')}\n                        onChange={() => console.log('CardExpiryElement change')}\n                        onFocus={() => console.log('CardExpiryElement focus')}\n                        onReady={() => console.log('CardExpiryElement ready')}*/\n    ,\n    options: _objectSpread(_objectSpread({}, ELEMENT_OPTIONS), {}, {\n      placeholder: \"Expiry date\"\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 353,\n      columnNumber: 19\n    }\n  })), __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 17\n    }\n  }, __jsx(CardCvcElement, {\n    id: \"cvc\",\n    className: styles[\"payment-new__input\"]\n    /*onBlur={() => console.log('CardCvcElement blur')}\n                        onChange={() => console.log('CardCvcElement change')}\n                        onFocus={() => console.log('CardCvcElement focus')}\n                        onReady={() => console.log('CardCvcElement ready')}*/\n    ,\n    options: _objectSpread(_objectSpread({}, ELEMENT_OPTIONS), {}, {\n      placeholder: \"CVV number\"\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 19\n    }\n  }))), purchaseOption === PurchaseOption.WatchItAll && __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 15\n    }\n  }, __jsx(PromoCode, {\n    data: promoCode,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 378,\n      columnNumber: 17\n    }\n  })), (purchaseOption === PurchaseOption.SeasonPass || purchaseOption === PurchaseOption.GamePass) && __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 15\n    }\n  }, __jsx(Input, {\n    placeholder: \"Promo code\",\n    disabled: true,\n    label: \"promoCode\",\n    type: \"text\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 17\n    }\n  })), __jsx(\"div\", {\n    className: styles[\"payment-new__total\"],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 15\n    }\n  }, \"Total\"), __jsx(\"div\", {\n    className: \"text-right\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 395,\n      columnNumber: 15\n    }\n  }, total), purchaseOption === PurchaseOption.WatchItAll && __jsx(React.Fragment, null, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 19\n    }\n  }, \"Next Payment Date\"), __jsx(\"div\", {\n    className: \"text-right\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 19\n    }\n  }, computeTrial))), __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    type: \"submit\",\n    variant: \"secondary\",\n    color: \"success\",\n    label: \"Purchase Plan\",\n    isLoading: isSaving,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 15\n    }\n  })), __jsx(\"div\", {\n    className: styles[\"payment-new__tos-links\"],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 413,\n      columnNumber: 13\n    }\n  }, __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 414,\n      columnNumber: 15\n    }\n  }, \"By creating an account, you are agreeing to our\", \" \", __jsx(Link, {\n    to: \"/terms-of-service\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 416,\n      columnNumber: 17\n    }\n  }, \"Terms\"), \" and\", \" \", __jsx(Link, {\n    to: \"/privacy-policy\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 17\n    }\n  }, \"Privacy Policy\"), \".\"))))));\n};\n\nexport default PaymentNew;","map":{"version":3,"sources":["/Users/ognjen/Desktop/with-typescript/src/scenes/Payment/PaymentNew.tsx"],"names":["React","useEffect","useState","_","useForm","useField","CardNumberElement","CardCvcElement","CardExpiryElement","useElements","useStripe","eventTypes","styles","PromoCode","Input","Button","useDispatch","useSelector","purchaseTagRequestedEvent","purchaseWatchItAllRequestedEvent","showPurchaseModalToggledEvent","purchaseGamePassRequestedEvent","promoRequestedEvent","PurchaseOption","push","selectGamePassPriceFormatted","selectWatchItAllPriceFormatted","selectSeasonPassPriceFormatted","isGamePass","isSeasonPass","selectPromoCode","moment","Product","productColor","Link","selectTag","StreamTypes","ELEMENT_OPTIONS","style","base","fontFamily","fontSize","backgroundColor","color","lineHeight","invalid","validate","values","errors","promoCode","undefined","cardName","cardNumber","ccv","expiry","PaymentNew","props","elements","stripe","nameOnCard","postal","errorMessage","setErrorMessage","setPaymentMethod","initialValues","onSubmit","payload","form","watchItAllPriceFormatted","state","payments","products","configuration","gamePassPriceFormatted","seasonPassPriceFormatted","gamePassSelected","purchase","seasonPassSelected","name","userSecurity","profile","isSaving","promo","tag","tagId","input","onBlur","e","price","getPresetPrice","replace","dispatch","value","streams","content","tags","stream","find","eventId","total","setTotal","computeTrial","calculateTrial","WatchItAll","purchaseOption","setPurchaseOption","description","setDescription","continueFree","videoStream","videoStreams","filter","streamType","MatchStream","streamName","GamePass","SeasonPass","daysAfter","Date","add","format","nextPayment","priceAfter","parseFloat","toFixed","handleSubmit2","event","preventDefault","cardElement","getElement","createToken","token","type","PAYMENTS_PAYMENT_DETAILS_RECEIVED","PAYMENTS_PAYMENT_DETAILS_ERRORED","createPaymentMethod","card","billing_details","address","postal_code","error","console","log","message","paymentMethod","stopPropagation","green","placeholder"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport _ from \"lodash\";\nimport { useForm, useField } from \"react-final-form-hooks\";\nimport { StripeCardElementOptions } from \"@stripe/stripe-js\";\nimport {\n  CardNumberElement,\n  CardCvcElement,\n  CardExpiryElement,\n  useElements,\n  useStripe,\n} from \"@stripe/react-stripe-js\";\n\nimport * as eventTypes from \"../../services/payments/paymentDetails/eventTypes\";\n\nimport styles from \"./Payment.module.scss\";\n\nimport PromoCode from \"../../components/PromoCode/PromoCode\";\nimport Input from \"../../components/Input/Input\";\nimport Button from \"../../components/Button/Button\";\n\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { RootState } from \"../../services/RootState\";\nimport {\n  purchaseTagRequestedEvent,\n  purchaseWatchItAllRequestedEvent,\n  showPurchaseModalToggledEvent,\n  purchaseGamePassRequestedEvent,\n  promoRequestedEvent,\n} from \"../../services/payments/purchase/events\";\nimport {\n  PromoInformation,\n  PurchaseOption,\n} from \"../../services/payments/purchase/models\";\nimport { push } from \"connected-react-router\";\nimport {\n  selectGamePassPriceFormatted,\n  selectWatchItAllPriceFormatted,\n  selectSeasonPassPriceFormatted,\n} from \"../../services/payments/products/selectors\";\n\nimport {\n  isGamePass,\n  isSeasonPass,\n  selectPromoCode,\n} from \"../../services/payments/purchase/selectors\";\n\nimport moment from \"moment\";\nimport Product, { productColor } from \"../../components/Product/Product\";\nimport { Link } from \"react-router-dom\";\nimport { selectTag } from \"../../services/content/tags/selectors\";\nimport { IStream, ITag, StreamTypes } from \"../../services/content/tags/models\";\nimport { debug } from \"console\";\n\ninterface IPaymentNewFormValues {\n  promoCode: string | undefined;\n  cardName: string | undefined;\n  cardNumber: string | undefined;\n  ccv: string | undefined;\n  expiry: string | undefined;\n}\n\ninterface IPaymentNewProps {\n  readonly tagInfo: any | undefined;\n  readonly eventId: number | undefined;\n  readonly isLoggedIn: boolean;\n}\n\nconst ELEMENT_OPTIONS: StripeCardElementOptions = {\n  style: {\n    base: {\n      fontFamily: \"Modern Era, sans-serif\",\n      fontSize: \"13px\",\n      backgroundColor: \"transparent\",\n      color: \"#F5F5F5\",\n      lineHeight: \"auto\",\n    },\n    invalid: {\n      color: \"#e82e06\",\n    },\n  },\n};\n\nconst validate = (values: IPaymentNewFormValues) => {\n  const errors: IPaymentNewFormValues = {\n    promoCode: undefined,\n    cardName: undefined,\n    cardNumber: undefined,\n    ccv: undefined,\n    expiry: undefined,\n  };\n\n  return errors;\n};\nconst PaymentNew: React.FC<IPaymentNewProps> = (props) => {\n  const elements = useElements();\n  const stripe = useStripe();\n\n  const [nameOnCard] = useState(\"\");\n  const [postal] = useState(\"\");\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [, setPaymentMethod] = useState(null);\n  // Initial values form\n  const initialValues: Partial<IPaymentNewFormValues> = {\n    promoCode: undefined,\n    cardName: undefined,\n    cardNumber: undefined,\n    ccv: undefined,\n    expiry: undefined,\n  };\n  const onSubmit = async (payload: any) => {};\n  const { form /*, handleSubmit, submitting */ } = useForm({\n    onSubmit,\n    validate,\n    initialValues,\n  });\n\n  const watchItAllPriceFormatted = useSelector<RootState, string>((state) =>\n    selectWatchItAllPriceFormatted(\n      state.payments?.products,\n      state.configuration\n    )\n  );\n  const gamePassPriceFormatted = useSelector<RootState, string>((state) =>\n    selectGamePassPriceFormatted(state.payments?.products, state.configuration)\n  );\n  const seasonPassPriceFormatted = useSelector<RootState, string>((state) =>\n    selectSeasonPassPriceFormatted(state)\n  );\n\n  const gamePassSelected = useSelector<RootState, boolean>((state) =>\n    isGamePass(state.payments.purchase)\n  );\n  const seasonPassSelected = useSelector<RootState, boolean>((state) =>\n    isSeasonPass(state.payments.purchase)\n  );\n  const name = useSelector<RootState, string>(\n    (state) => state.userSecurity?.profile?.name || \"\"\n  );\n  const isSaving = useSelector<RootState, boolean>(\n    (state) => state.payments.purchase.isSaving\n  );\n  const promo = useSelector<RootState, PromoInformation | undefined>((state) =>\n    selectPromoCode(state.payments.purchase)\n  );\n  const promoCode = useField(\"promoCode\", form);\n  const tag = useSelector<RootState, ITag | undefined>((state) =>\n    selectTag(state, state.payments.purchase.tagId)\n  );\n\n  promoCode.input.onBlur = (e) => {\n    const price = getPresetPrice().replace(/^[$*]/g, \"\");\n    dispatch(promoRequestedEvent(promoCode.input.value, price));\n  };\n  const streams = useSelector<RootState, IStream[] | undefined>(\n    (state) => state.content.tags.streams\n  );\n  const stream: IStream | undefined = _.find(\n    streams || [],\n    (stream: IStream) => stream.eventId === props.eventId\n  );\n\n  const [total, setTotal] = useState();\n  const [computeTrial, calculateTrial] = useState(\"\");\n  const [purchaseOption, setPurchaseOption] = useState<PurchaseOption>(\n    PurchaseOption.WatchItAll\n  );\n  const [description, setDescription] = useState(\"\\u00A0\");\n  const dispatch = useDispatch();\n\n  const continueFree = () => {\n    dispatch(showPurchaseModalToggledEvent(undefined, undefined, undefined));\n    push(\"/browse\");\n  };\n\n  const getPresetPrice = () => {\n    if (gamePassSelected) return gamePassPriceFormatted;\n    else if (seasonPassSelected) return seasonPassPriceFormatted;\n    else return watchItAllPriceFormatted;\n  };\n  useEffect(() => {\n    setTotal(getPresetPrice());\n    if (gamePassSelected) {\n      const videoStream = stream?.videoStreams.filter(\n        (stream) => stream.streamType === StreamTypes.MatchStream\n      )[0].streamName;\n      setPurchaseOption(PurchaseOption.GamePass);\n      setDescription(videoStream ?? \"\\u00A0\");\n    } else if (seasonPassSelected) {\n      setPurchaseOption(PurchaseOption.SeasonPass);\n      setDescription(tag?.name ?? \"*Season Passes may vary in price\");\n    } else {\n      setPurchaseOption(PurchaseOption.WatchItAll);\n    }\n\n    const daysAfter = moment(new Date()).add(30, \"days\");\n    calculateTrial(`${daysAfter.format(\"DD.MM.YYYY\")}`);\n  }, []);\n\n  useEffect(() => {\n    const daysAfter = moment(new Date()).add(30, \"days\");\n    calculateTrial(promo?.nextPayment ?? `${daysAfter.format(\"DD.MM.YYYY\")}`);\n\n    if (promo?.priceAfter) {\n      setTotal(`$${(parseFloat(promo?.priceAfter ?? \"0\") / 100).toFixed(2)}`);\n    } else {\n      setTotal(getPresetPrice());\n    }\n  }, [promo]);\n  const handleSubmit2 = async (event) => {\n    event.preventDefault();\n\n    if (!stripe || !elements) {\n      // Stripe.js has not loaded yet. Make sure to disable\n      // form submission until Stripe.js has loaded.\n      return;\n    }\n\n    const cardElement = elements.getElement(CardNumberElement);\n\n    try {\n      const token = await stripe.createToken(cardElement as any);\n      dispatch({\n        type: [eventTypes.PAYMENTS_PAYMENT_DETAILS_RECEIVED],\n        payload: token,\n      });\n    } catch (error) {\n      dispatch({\n        type: [eventTypes.PAYMENTS_PAYMENT_DETAILS_ERRORED],\n        payload: error,\n      });\n    }\n\n    const payload = await stripe.createPaymentMethod({\n      type: \"card\",\n      card: cardElement as any,\n      billing_details: {\n        name,\n        address: {\n          postal_code: postal,\n        },\n      },\n    });\n\n    if (payload.error) {\n      console.log(\"Payment.tsx [error]\", payload.error);\n      setErrorMessage(payload.error.message as any);\n      setPaymentMethod(null);\n    } else {\n      setPaymentMethod(payload.paymentMethod as any);\n\n      switch (purchaseOption) {\n        case PurchaseOption.WatchItAll:\n          dispatch(\n            purchaseWatchItAllRequestedEvent(promoCode.input.value, payload)\n          );\n          break;\n        case PurchaseOption.SeasonPass:\n          // console.log(payload);\n          dispatch(purchaseTagRequestedEvent(payload));\n          break;\n        case PurchaseOption.GamePass:\n          dispatch(purchaseGamePassRequestedEvent(payload));\n          break;\n      }\n      setErrorMessage(\"\");\n    }\n  };\n  return (\n    <div className={styles[\"payment-new\"]} onClick={(e) => e.stopPropagation()}>\n      <div className={styles[\"payment-new__content\"]}>\n        <div className={styles[\"payment-new__pricing-details\"]}>\n          <p className={styles[\"payment-new__header\"]}>Plan details</p>\n          {purchaseOption === PurchaseOption.GamePass && (\n            <Product\n              description={description}\n              features={[\n                \"Watch a events live\",\n                \"Watch unlimited on demand\",\n                \"Watch on any device\",\n              ]}\n              onModal={true}\n              color={productColor.green}\n              showPurchaseButton={false}\n              title={\"Game Pass\"}\n              price={`${gamePassPriceFormatted}`}\n            />\n          )}\n          {purchaseOption === PurchaseOption.SeasonPass && (\n            <Product\n              description={description}\n              features={[\n                \"Watch any event live from your selected season\",\n                \"Watch unlimited on demand\",\n                \"Watch on any device\",\n              ]}\n              onModal={true}\n              color={productColor.green}\n              showPurchaseButton={false}\n              title={\"Season Pass\"}\n              price={`${seasonPassPriceFormatted}`}\n            />\n          )}\n          {purchaseOption === PurchaseOption.WatchItAll && (\n            <Product\n              description={\"Monthly Subscription\"}\n              features={[\n                \"Watch all events live\",\n                \"Includes all competitions\",\n                \"No fixed term contracts\",\n                \"Watch unlimited on demand\",\n                \"Watch on any device\",\n              ]}\n              onModal={true}\n              color={productColor.green}\n              showPurchaseButton={false}\n              title={\"Watch It All\"}\n              price={`${watchItAllPriceFormatted} / Month`}\n            />\n          )}\n        </div>\n        <div className={styles[\"payment-new__payment-details\"]}>\n          <p className={styles[\"payment-new__header\"]}>Payment details</p>\n          <form\n            onSubmit={handleSubmit2}\n            className={styles[\"payment-new__form\"]}\n          >\n            <p>\n              <Input\n                data={nameOnCard}\n                placeholder=\"Name on card\"\n                label=\"cardName\"\n                type=\"text\"\n                required\n              />\n            </p>\n            {\n              <div className={styles[\"payment-new__form-group\"]}>\n                <p>\n                  <CardNumberElement\n                    id=\"cardNumber\"\n                    className={styles[\"payment-new__input\"]}\n                    /*onBlur={() => console.log('CardCvcElement blur')}\n                                        onChange={() => console.log('CardCvcElement change')}\n                                        onFocus={() => console.log('CardCvcElement focus')}\n                                        onReady={() => console.log('CardCvcElement ready')}*/\n                    options={{\n                      ...ELEMENT_OPTIONS,\n                      placeholder: \"Credit card number \",\n                    }}\n                  />\n                </p>\n                <p>\n                  <CardExpiryElement\n                    id=\"expiry\"\n                    className={styles[\"payment-new__input\"]}\n                    /*onBlur={() => console.log('CardExpiryElement blur')}\n                                        onChange={() => console.log('CardExpiryElement change')}\n                                        onFocus={() => console.log('CardExpiryElement focus')}\n                                        onReady={() => console.log('CardExpiryElement ready')}*/\n                    options={{ ...ELEMENT_OPTIONS, placeholder: \"Expiry date\" }}\n                  />\n                </p>\n                <p>\n                  <CardCvcElement\n                    id=\"cvc\"\n                    className={styles[\"payment-new__input\"]}\n                    /*onBlur={() => console.log('CardCvcElement blur')}\n                                        onChange={() => console.log('CardCvcElement change')}\n                                        onFocus={() => console.log('CardCvcElement focus')}\n                                        onReady={() => console.log('CardCvcElement ready')}*/\n                    options={{ ...ELEMENT_OPTIONS, placeholder: \"CVV number\" }}\n                  />\n                </p>\n              </div>\n            }\n            {purchaseOption === PurchaseOption.WatchItAll && (\n              <p>\n                <PromoCode data={promoCode} />\n                {/* <Input placeholder=\"Promo code\"  data={promoCode}  label=\"promoCode\" type=\"text\" /> */}\n              </p>\n            )}\n            {(purchaseOption === PurchaseOption.SeasonPass ||\n              purchaseOption === PurchaseOption.GamePass) && (\n              <p>\n                <Input\n                  placeholder=\"Promo code\"\n                  disabled={true}\n                  label=\"promoCode\"\n                  type=\"text\"\n                />\n              </p>\n            )}\n            <div className={styles[\"payment-new__total\"]}>\n              <div>Total</div>\n              <div className=\"text-right\">{total}</div>\n              {purchaseOption === PurchaseOption.WatchItAll && (\n                <>\n                  <div>Next Payment Date</div>\n                  <div className=\"text-right\">{computeTrial}</div>\n                </>\n              )}\n            </div>\n            <p>\n              <Button\n                type=\"submit\"\n                variant=\"secondary\"\n                color=\"success\"\n                label=\"Purchase Plan\"\n                isLoading={isSaving}\n              />\n            </p>\n\n            <div className={styles[\"payment-new__tos-links\"]}>\n              <p>\n                By creating an account, you are agreeing to our{\" \"}\n                <Link to=\"/terms-of-service\">Terms</Link> and{\" \"}\n                <Link to=\"/privacy-policy\">Privacy Policy</Link>.\n              </p>\n            </div>\n          </form>\n        </div>\n      </div>\n      {/* {!isSaving && (\n        <Button\n          className={styles['payment-new__continue-free']}\n          variant=\"secondary\"\n          color=\"ghost-green\"\n          onClick={continueFree}\n          label=\"Continue for Free\"\n        ></Button>\n      )} */}\n    </div>\n  );\n};\n\nexport default PaymentNew;\n"]},"metadata":{},"sourceType":"module"}