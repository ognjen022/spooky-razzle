{"ast":null,"code":"import _objectSpread from \"/Users/ognjen/Desktop/with-typescript/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"/Users/ognjen/Desktop/with-typescript/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/ognjen/Desktop/with-typescript/src/scenes/Payment/PaymentNew.tsx\",\n    _this = this;\n\nvar __jsx = React.createElement;\nimport _regeneratorRuntime from \"/Users/ognjen/Desktop/with-typescript/node_modules/@babel/runtime/regenerator\";\nimport React, { useEffect, useState } from 'react';\nimport _ from 'lodash';\nimport { useForm, useField } from 'react-final-form-hooks';\nimport { CardNumberElement, CardCvcElement, CardExpiryElement, useElements, useStripe } from '@stripe/react-stripe-js';\nimport * as eventTypes from '../../services/payments/paymentDetails/eventTypes';\nimport styles from './Payment.module.scss';\nimport PromoCode from '../../components/PromoCode/PromoCode';\nimport Input from '../../components/Input/Input';\nimport Button from '../../components/Button/Button';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { purchaseTagRequestedEvent, purchaseWatchItAllRequestedEvent, showPurchaseModalToggledEvent, purchaseGamePassRequestedEvent, promoRequestedEvent } from '../../services/payments/purchase/events';\nimport { PurchaseOption } from '../../services/payments/purchase/models';\nimport { push } from 'connected-react-router';\nimport { selectGamePassPriceFormatted, selectWatchItAllPriceFormatted, selectSeasonPassPriceFormatted } from '../../services/payments/products/selectors';\nimport { isGamePass, isSeasonPass, selectPromoCode } from '../../services/payments/purchase/selectors';\nimport moment from 'moment';\nimport Product, { productColor } from '../../components/Product/Product';\nimport { Link } from 'react-router-dom';\nimport { selectTag } from '../../services/content/tags/selectors';\nimport { StreamTypes } from '../../services/content/tags/models';\nvar ELEMENT_OPTIONS = {\n  style: {\n    base: {\n      fontFamily: 'Modern Era, sans-serif',\n      fontSize: '13px',\n      backgroundColor: 'transparent',\n      color: '#F5F5F5',\n      lineHeight: 'auto'\n    },\n    invalid: {\n      color: '#e82e06'\n    }\n  }\n};\n\nvar validate = function validate(values) {\n  var errors = {\n    promoCode: undefined,\n    cardName: undefined,\n    cardNumber: undefined,\n    ccv: undefined,\n    expiry: undefined\n  };\n  return errors;\n};\n\nvar PaymentNew = function PaymentNew(props) {\n  var elements = useElements();\n  var stripe = useStripe();\n\n  var _useState = useState(''),\n      nameOnCard = _useState[0];\n\n  var _useState2 = useState(''),\n      postal = _useState2[0];\n\n  var _useState3 = useState(''),\n      errorMessage = _useState3[0],\n      setErrorMessage = _useState3[1];\n\n  var _useState4 = useState(null),\n      setPaymentMethod = _useState4[1]; // Initial values form\n\n\n  var initialValues = {\n    promoCode: undefined,\n    cardName: undefined,\n    cardNumber: undefined,\n    ccv: undefined,\n    expiry: undefined\n  };\n\n  var onSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(payload) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var _useForm = useForm({\n    onSubmit: onSubmit,\n    validate: validate,\n    initialValues: initialValues\n  }),\n      form = _useForm.form;\n\n  var watchItAllPriceFormatted = useSelector(function (state) {\n    var _state$payments;\n\n    return selectWatchItAllPriceFormatted((_state$payments = state.payments) === null || _state$payments === void 0 ? void 0 : _state$payments.products, state.configuration);\n  });\n  var gamePassPriceFormatted = useSelector(function (state) {\n    var _state$payments2;\n\n    return selectGamePassPriceFormatted((_state$payments2 = state.payments) === null || _state$payments2 === void 0 ? void 0 : _state$payments2.products, state.configuration);\n  });\n  var seasonPassPriceFormatted = useSelector(function (state) {\n    return selectSeasonPassPriceFormatted(state);\n  });\n  var gamePassSelected = useSelector(function (state) {\n    return isGamePass(state.payments.purchase);\n  });\n  var seasonPassSelected = useSelector(function (state) {\n    return isSeasonPass(state.payments.purchase);\n  });\n  var name = useSelector(function (state) {\n    var _state$userSecurity, _state$userSecurity$p;\n\n    return ((_state$userSecurity = state.userSecurity) === null || _state$userSecurity === void 0 ? void 0 : (_state$userSecurity$p = _state$userSecurity.profile) === null || _state$userSecurity$p === void 0 ? void 0 : _state$userSecurity$p.name) || '';\n  });\n  var isSaving = useSelector(function (state) {\n    return state.payments.purchase.isSaving;\n  });\n  var promo = useSelector(function (state) {\n    return selectPromoCode(state.payments.purchase);\n  });\n  var promoCode = useField('promoCode', form);\n  var tag = useSelector(function (state) {\n    return selectTag(state, state.payments.purchase.tagId);\n  });\n\n  promoCode.input.onBlur = function (e) {\n    var price = getPresetPrice().replace(/^[$*]/g, '');\n    dispatch(promoRequestedEvent(promoCode.input.value, price));\n  };\n\n  var streams = useSelector(function (state) {\n    return state.content.tags.streams;\n  });\n\n  var stream = _.find(streams || [], function (stream) {\n    return stream.eventId === props.eventId;\n  });\n\n  var _useState5 = useState(''),\n      total = _useState5[0],\n      setTotal = _useState5[1];\n\n  var _useState6 = useState(''),\n      computeTrial = _useState6[0],\n      calculateTrial = _useState6[1];\n\n  var _useState7 = useState(PurchaseOption.WatchItAll),\n      purchaseOption = _useState7[0],\n      setPurchaseOption = _useState7[1];\n\n  var _useState8 = useState(\"\\xA0\"),\n      description = _useState8[0],\n      setDescription = _useState8[1];\n\n  var dispatch = useDispatch();\n\n  var continueFree = function continueFree() {\n    dispatch(showPurchaseModalToggledEvent(undefined, undefined, undefined));\n    push('/browse');\n  };\n\n  var getPresetPrice = function getPresetPrice() {\n    if (gamePassSelected) return gamePassPriceFormatted;else if (seasonPassSelected) return seasonPassPriceFormatted;else return watchItAllPriceFormatted;\n  };\n\n  useEffect(function () {\n    setTotal(getPresetPrice());\n\n    if (gamePassSelected) {\n      var videoStream = stream === null || stream === void 0 ? void 0 : stream.videoStreams.filter(function (stream) {\n        return stream.streamType === StreamTypes.MatchStream;\n      })[0].streamName;\n      setPurchaseOption(PurchaseOption.GamePass);\n      setDescription(videoStream !== null && videoStream !== void 0 ? videoStream : \"\\xA0\");\n    } else if (seasonPassSelected) {\n      var _tag$name;\n\n      setPurchaseOption(PurchaseOption.SeasonPass);\n      setDescription((_tag$name = tag === null || tag === void 0 ? void 0 : tag.name) !== null && _tag$name !== void 0 ? _tag$name : '*Season Passes may vary in price');\n    } else {\n      setPurchaseOption(PurchaseOption.WatchItAll);\n    }\n\n    var daysAfter = moment(new Date()).add(30, 'days');\n    calculateTrial(\"\".concat(daysAfter.format('DD.MM.YYYY')));\n  }, []);\n  useEffect(function () {\n    var _promo$nextPayment;\n\n    var daysAfter = moment(new Date()).add(30, 'days');\n    calculateTrial((_promo$nextPayment = promo === null || promo === void 0 ? void 0 : promo.nextPayment) !== null && _promo$nextPayment !== void 0 ? _promo$nextPayment : \"\".concat(daysAfter.format('DD.MM.YYYY')));\n\n    if (promo === null || promo === void 0 ? void 0 : promo.priceAfter) {\n      var _promo$priceAfter;\n\n      setTotal(\"$\".concat((parseFloat((_promo$priceAfter = promo === null || promo === void 0 ? void 0 : promo.priceAfter) !== null && _promo$priceAfter !== void 0 ? _promo$priceAfter : 0) / 100).toFixed(2)));\n    } else {\n      setTotal(getPresetPrice());\n    }\n  }, [promo]);\n\n  var handleSubmit2 = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event) {\n      var cardElement, token, payload;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              event.preventDefault();\n\n              if (!(!stripe || !elements)) {\n                _context2.next = 3;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 3:\n              cardElement = elements.getElement(CardNumberElement);\n              _context2.prev = 4;\n              _context2.next = 7;\n              return stripe.createToken(cardElement);\n\n            case 7:\n              token = _context2.sent;\n              dispatch({\n                type: [eventTypes.PAYMENTS_PAYMENT_DETAILS_RECEIVED],\n                payload: token\n              });\n              _context2.next = 14;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](4);\n              dispatch({\n                type: [eventTypes.PAYMENTS_PAYMENT_DETAILS_ERRORED],\n                payload: _context2.t0\n              });\n\n            case 14:\n              _context2.next = 16;\n              return stripe.createPaymentMethod({\n                type: 'card',\n                card: cardElement,\n                billing_details: {\n                  name: name,\n                  address: {\n                    postal_code: postal\n                  }\n                }\n              });\n\n            case 16:\n              payload = _context2.sent;\n\n              if (!payload.error) {\n                _context2.next = 23;\n                break;\n              }\n\n              console.log('Payment.tsx [error]', payload.error);\n              setErrorMessage(payload.error.message);\n              setPaymentMethod(null);\n              _context2.next = 34;\n              break;\n\n            case 23:\n              setPaymentMethod(payload.paymentMethod);\n              _context2.t1 = purchaseOption;\n              _context2.next = _context2.t1 === PurchaseOption.WatchItAll ? 27 : _context2.t1 === PurchaseOption.SeasonPass ? 29 : _context2.t1 === PurchaseOption.GamePass ? 31 : 33;\n              break;\n\n            case 27:\n              dispatch(purchaseWatchItAllRequestedEvent(promoCode.input.value, payload));\n              return _context2.abrupt(\"break\", 33);\n\n            case 29:\n              // console.log(payload);\n              dispatch(purchaseTagRequestedEvent(payload));\n              return _context2.abrupt(\"break\", 33);\n\n            case 31:\n              dispatch(purchaseGamePassRequestedEvent(payload));\n              return _context2.abrupt(\"break\", 33);\n\n            case 33:\n              setErrorMessage('');\n\n            case 34:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[4, 11]]);\n    }));\n\n    return function handleSubmit2(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    className: styles['payment-new'],\n    onClick: function onClick(e) {\n      return e.stopPropagation();\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: styles['payment-new__content'],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: styles['payment-new__pricing-details'],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 9\n    }\n  }, __jsx(\"p\", {\n    className: styles['payment-new__header'],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 11\n    }\n  }, \"Plan details\"), purchaseOption === PurchaseOption.GamePass && __jsx(Product, {\n    description: description,\n    features: ['Watch a events live', 'Watch unlimited on demand', 'Watch on any device'],\n    onModal: true,\n    color: productColor.green,\n    showPurchaseButton: false,\n    title: 'Game Pass',\n    price: \"\".concat(gamePassPriceFormatted),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 13\n    }\n  }), purchaseOption === PurchaseOption.SeasonPass && __jsx(Product, {\n    description: description,\n    features: ['Watch any event live from your selected season', 'Watch unlimited on demand', 'Watch on any device'],\n    onModal: true,\n    color: productColor.green,\n    showPurchaseButton: false,\n    title: 'Season Pass',\n    price: \"\".concat(seasonPassPriceFormatted),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 13\n    }\n  }), purchaseOption === PurchaseOption.WatchItAll && __jsx(Product, {\n    description: 'Monthly Subscription',\n    features: ['Watch all events live', 'Includes all competitions', 'No fixed term contracts', 'Watch unlimited on demand', 'Watch on any device'],\n    onModal: true,\n    color: productColor.green,\n    showPurchaseButton: false,\n    title: 'Watch It All',\n    price: \"\".concat(watchItAllPriceFormatted, \" / Month\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 13\n    }\n  })), __jsx(\"div\", {\n    className: styles['payment-new__payment-details'],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 9\n    }\n  }, __jsx(\"p\", {\n    className: styles['payment-new__header'],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 11\n    }\n  }, \"Payment details\"), __jsx(\"form\", {\n    onSubmit: handleSubmit2,\n    className: styles['payment-new__form'],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 11\n    }\n  }, __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 13\n    }\n  }, __jsx(Input, {\n    data: nameOnCard,\n    placeholder: \"Name on card\",\n    label: \"cardName\",\n    type: \"text\",\n    required: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 15\n    }\n  })), __jsx(\"div\", {\n    className: styles['payment-new__form-group'],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 15\n    }\n  }, __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 17\n    }\n  }, __jsx(CardNumberElement, {\n    id: \"cardNumber\",\n    className: styles['payment-new__input']\n    /*onBlur={() => console.log('CardCvcElement blur')}\n                        onChange={() => console.log('CardCvcElement change')}\n                        onFocus={() => console.log('CardCvcElement focus')}\n                        onReady={() => console.log('CardCvcElement ready')}*/\n    ,\n    options: _objectSpread(_objectSpread({}, ELEMENT_OPTIONS), {}, {\n      placeholder: 'Credit card number '\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 19\n    }\n  })), __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 17\n    }\n  }, __jsx(CardExpiryElement, {\n    id: \"expiry\",\n    className: styles['payment-new__input']\n    /*onBlur={() => console.log('CardExpiryElement blur')}\n                        onChange={() => console.log('CardExpiryElement change')}\n                        onFocus={() => console.log('CardExpiryElement focus')}\n                        onReady={() => console.log('CardExpiryElement ready')}*/\n    ,\n    options: _objectSpread(_objectSpread({}, ELEMENT_OPTIONS), {}, {\n      placeholder: 'Expiry date'\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 19\n    }\n  })), __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 17\n    }\n  }, __jsx(CardCvcElement, {\n    id: \"cvc\",\n    className: styles['payment-new__input']\n    /*onBlur={() => console.log('CardCvcElement blur')}\n                        onChange={() => console.log('CardCvcElement change')}\n                        onFocus={() => console.log('CardCvcElement focus')}\n                        onReady={() => console.log('CardCvcElement ready')}*/\n    ,\n    options: _objectSpread(_objectSpread({}, ELEMENT_OPTIONS), {}, {\n      placeholder: 'CVV number'\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 19\n    }\n  }))), purchaseOption === PurchaseOption.WatchItAll && __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 15\n    }\n  }, __jsx(PromoCode, {\n    data: promoCode,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 17\n    }\n  })), (purchaseOption === PurchaseOption.SeasonPass || purchaseOption === PurchaseOption.GamePass) && __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 15\n    }\n  }, __jsx(Input, {\n    placeholder: \"Promo code\",\n    disabled: true,\n    label: \"promoCode\",\n    type: \"text\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 17\n    }\n  })), __jsx(\"div\", {\n    className: styles['payment-new__total'],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 15\n    }\n  }, \"Total\"), __jsx(\"div\", {\n    className: \"text-right\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 15\n    }\n  }, total), purchaseOption === PurchaseOption.WatchItAll && __jsx(React.Fragment, null, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 19\n    }\n  }, \"Next Payment Date\"), __jsx(\"div\", {\n    className: \"text-right\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 19\n    }\n  }, computeTrial))), __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    type: \"submit\",\n    variant: \"secondary\",\n    color: \"success\",\n    label: \"Purchase Plan\",\n    isLoading: isSaving,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 327,\n      columnNumber: 15\n    }\n  })), __jsx(\"div\", {\n    className: styles['payment-new__tos-links'],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 13\n    }\n  }, __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 15\n    }\n  }, \"By creating an account, you are agreeing to our \", __jsx(Link, {\n    to: \"/terms-of-service\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 65\n    }\n  }, \"Terms\"), \" and\", ' ', __jsx(Link, {\n    to: \"/privacy-policy\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 17\n    }\n  }, \"Privacy Policy\"), \".\"))))));\n};\n\nexport default PaymentNew;","map":{"version":3,"sources":["/Users/ognjen/Desktop/with-typescript/src/scenes/Payment/PaymentNew.tsx"],"names":["React","useEffect","useState","_","useForm","useField","CardNumberElement","CardCvcElement","CardExpiryElement","useElements","useStripe","eventTypes","styles","PromoCode","Input","Button","useDispatch","useSelector","purchaseTagRequestedEvent","purchaseWatchItAllRequestedEvent","showPurchaseModalToggledEvent","purchaseGamePassRequestedEvent","promoRequestedEvent","PurchaseOption","push","selectGamePassPriceFormatted","selectWatchItAllPriceFormatted","selectSeasonPassPriceFormatted","isGamePass","isSeasonPass","selectPromoCode","moment","Product","productColor","Link","selectTag","StreamTypes","ELEMENT_OPTIONS","style","base","fontFamily","fontSize","backgroundColor","color","lineHeight","invalid","validate","values","errors","promoCode","undefined","cardName","cardNumber","ccv","expiry","PaymentNew","props","elements","stripe","nameOnCard","postal","errorMessage","setErrorMessage","setPaymentMethod","initialValues","onSubmit","payload","form","watchItAllPriceFormatted","state","payments","products","configuration","gamePassPriceFormatted","seasonPassPriceFormatted","gamePassSelected","purchase","seasonPassSelected","name","userSecurity","profile","isSaving","promo","tag","tagId","input","onBlur","e","price","getPresetPrice","replace","dispatch","value","streams","content","tags","stream","find","eventId","total","setTotal","computeTrial","calculateTrial","WatchItAll","purchaseOption","setPurchaseOption","description","setDescription","continueFree","videoStream","videoStreams","filter","streamType","MatchStream","streamName","GamePass","SeasonPass","daysAfter","Date","add","format","nextPayment","priceAfter","parseFloat","toFixed","handleSubmit2","event","preventDefault","cardElement","getElement","createToken","token","type","PAYMENTS_PAYMENT_DETAILS_RECEIVED","PAYMENTS_PAYMENT_DETAILS_ERRORED","createPaymentMethod","card","billing_details","address","postal_code","error","console","log","message","paymentMethod","stopPropagation","green","placeholder"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport _ from 'lodash'\nimport { useForm, useField } from 'react-final-form-hooks'\nimport { StripeCardElementOptions } from '@stripe/stripe-js'\nimport { CardNumberElement, CardCvcElement, CardExpiryElement, useElements, useStripe } from '@stripe/react-stripe-js'\n\nimport * as eventTypes from '../../services/payments/paymentDetails/eventTypes'\n\nimport styles from './Payment.module.scss'\n\nimport PromoCode from '../../components/PromoCode/PromoCode'\nimport Input from '../../components/Input/Input'\nimport Button from '../../components/Button/Button'\n\nimport { useDispatch, useSelector } from 'react-redux'\nimport { RootState } from '../../services/RootState'\nimport {\n  purchaseTagRequestedEvent,\n  purchaseWatchItAllRequestedEvent,\n  showPurchaseModalToggledEvent,\n  purchaseGamePassRequestedEvent,\n  promoRequestedEvent,\n} from '../../services/payments/purchase/events'\nimport { PromoInformation, PurchaseOption } from '../../services/payments/purchase/models'\nimport { push } from 'connected-react-router'\nimport {\n  selectGamePassPriceFormatted,\n  selectWatchItAllPriceFormatted,\n  selectSeasonPassPriceFormatted,\n} from '../../services/payments/products/selectors'\n\nimport { isGamePass, isSeasonPass, selectPromoCode } from '../../services/payments/purchase/selectors'\n\nimport moment from 'moment'\nimport Product, { productColor } from '../../components/Product/Product'\nimport { Link } from 'react-router-dom'\nimport { selectTag } from '../../services/content/tags/selectors'\nimport { IStream, ITag, StreamTypes } from '../../services/content/tags/models'\nimport { debug } from 'console'\n\ninterface IPaymentNewFormValues {\n  promoCode: string | undefined\n  cardName: string | undefined\n  cardNumber: string | undefined\n  ccv: string | undefined\n  expiry: string | undefined\n}\n\ninterface IPaymentNewProps {\n  readonly tagInfo: any | undefined\n  readonly eventId: number | undefined\n  readonly isLoggedIn: boolean\n}\n\nconst ELEMENT_OPTIONS: StripeCardElementOptions = {\n  style: {\n    base: {\n      fontFamily: 'Modern Era, sans-serif',\n      fontSize: '13px',\n      backgroundColor: 'transparent',\n      color: '#F5F5F5',\n      lineHeight: 'auto',\n    },\n    invalid: {\n      color: '#e82e06',\n    },\n  },\n}\n\nconst validate = (values: IPaymentNewFormValues) => {\n  const errors: IPaymentNewFormValues = {\n    promoCode: undefined,\n    cardName: undefined,\n    cardNumber: undefined,\n    ccv: undefined,\n    expiry: undefined,\n  }\n\n  return errors\n}\nconst PaymentNew: React.FC<IPaymentNewProps> = (props) => {\n  const elements = useElements()\n  const stripe = useStripe()\n\n  const [nameOnCard] = useState('')\n  const [postal] = useState('')\n  const [errorMessage, setErrorMessage] = useState('')\n  const [, setPaymentMethod] = useState(null)\n  // Initial values form\n  const initialValues: Partial<IPaymentNewFormValues> = {\n    promoCode: undefined,\n    cardName: undefined,\n    cardNumber: undefined,\n    ccv: undefined,\n    expiry: undefined,\n  }\n  const onSubmit = async (payload: any) => {}\n  const { form /*, handleSubmit, submitting */ } = useForm({ onSubmit, validate, initialValues })\n\n  const watchItAllPriceFormatted = useSelector<RootState, string>((state) =>\n    selectWatchItAllPriceFormatted(state.payments?.products, state.configuration)\n  )\n  const gamePassPriceFormatted = useSelector<RootState, string>((state) =>\n    selectGamePassPriceFormatted(state.payments?.products, state.configuration)\n  )\n  const seasonPassPriceFormatted = useSelector<RootState, string>((state) => selectSeasonPassPriceFormatted(state))\n\n  const gamePassSelected = useSelector<RootState, boolean>((state) => isGamePass(state.payments.purchase))\n  const seasonPassSelected = useSelector<RootState, boolean>((state) => isSeasonPass(state.payments.purchase))\n  const name = useSelector<RootState, string>((state) => state.userSecurity?.profile?.name || '')\n  const isSaving = useSelector<RootState, boolean>((state) => state.payments.purchase.isSaving)\n  const promo = useSelector<RootState, PromoInformation | undefined>((state) => selectPromoCode(state.payments.purchase))\n  const promoCode = useField('promoCode', form)\n  const tag = useSelector<RootState, ITag | undefined>((state) => selectTag(state, state.payments.purchase.tagId))\n\n  promoCode.input.onBlur = (e) => {\n    const price = getPresetPrice().replace(/^[$*]/g, '')\n    dispatch(promoRequestedEvent(promoCode.input.value, price))\n  }\n  const streams = useSelector<RootState, IStream[] | undefined>((state) => state.content.tags.streams)\n  const stream: IStream | undefined = _.find(streams || [], (stream: IStream) => stream.eventId === props.eventId)\n\n  const [total, setTotal] = useState('')\n  const [computeTrial, calculateTrial] = useState('')\n  const [purchaseOption, setPurchaseOption] = useState<PurchaseOption>(PurchaseOption.WatchItAll)\n  const [description, setDescription] = useState('\\u00A0')\n  const dispatch = useDispatch()\n\n  const continueFree = () => {\n    dispatch(showPurchaseModalToggledEvent(undefined, undefined, undefined))\n    push('/browse')\n  }\n\n  const getPresetPrice = () => {\n    if (gamePassSelected) return gamePassPriceFormatted\n    else if (seasonPassSelected) return seasonPassPriceFormatted\n    else return watchItAllPriceFormatted\n  }\n  useEffect(() => {\n    setTotal(getPresetPrice())\n    if (gamePassSelected) {\n      const videoStream = stream?.videoStreams.filter((stream) => stream.streamType === StreamTypes.MatchStream)[0].streamName\n      setPurchaseOption(PurchaseOption.GamePass)\n      setDescription(videoStream ?? '\\u00A0')\n    } else if (seasonPassSelected) {\n      setPurchaseOption(PurchaseOption.SeasonPass)\n      setDescription(tag?.name ?? '*Season Passes may vary in price')\n    } else {\n      setPurchaseOption(PurchaseOption.WatchItAll)\n    }\n\n    const daysAfter = moment(new Date()).add(30, 'days')\n    calculateTrial(`${daysAfter.format('DD.MM.YYYY')}`)\n  }, [])\n\n  useEffect(() => {\n    const daysAfter = moment(new Date()).add(30, 'days')\n    calculateTrial(promo?.nextPayment ?? `${daysAfter.format('DD.MM.YYYY')}`)\n\n    if (promo?.priceAfter) {\n      setTotal(`$${(parseFloat(promo?.priceAfter ?? 0) / 100).toFixed(2)}`)\n    } else {\n      setTotal(getPresetPrice())\n    }\n  }, [promo])\n  const handleSubmit2 = async (event) => {\n    event.preventDefault()\n\n    if (!stripe || !elements) {\n      // Stripe.js has not loaded yet. Make sure to disable\n      // form submission until Stripe.js has loaded.\n      return\n    }\n\n    const cardElement = elements.getElement(CardNumberElement)\n\n    try {\n      const token = await stripe.createToken(cardElement as any)\n      dispatch({ type: [eventTypes.PAYMENTS_PAYMENT_DETAILS_RECEIVED], payload: token })\n    } catch (error) {\n      dispatch({ type: [eventTypes.PAYMENTS_PAYMENT_DETAILS_ERRORED], payload: error })\n    }\n\n    const payload = await stripe.createPaymentMethod({\n      type: 'card',\n      card: cardElement as any,\n      billing_details: {\n        name,\n        address: {\n          postal_code: postal,\n        },\n      },\n    })\n\n    if (payload.error) {\n      console.log('Payment.tsx [error]', payload.error)\n      setErrorMessage(payload.error.message as any)\n      setPaymentMethod(null)\n    } else {\n      setPaymentMethod(payload.paymentMethod as any)\n\n      switch (purchaseOption) {\n        case PurchaseOption.WatchItAll:\n          dispatch(purchaseWatchItAllRequestedEvent(promoCode.input.value, payload))\n          break\n        case PurchaseOption.SeasonPass:\n          // console.log(payload);\n          dispatch(purchaseTagRequestedEvent(payload))\n          break\n        case PurchaseOption.GamePass:\n          dispatch(purchaseGamePassRequestedEvent(payload))\n          break\n      }\n      setErrorMessage('')\n    }\n  }\n  return (\n    <div className={styles['payment-new']} onClick={(e) => e.stopPropagation()}>\n      <div className={styles['payment-new__content']}>\n        <div className={styles['payment-new__pricing-details']}>\n          <p className={styles['payment-new__header']}>Plan details</p>\n          {purchaseOption === PurchaseOption.GamePass && (\n            <Product\n              description={description}\n              features={['Watch a events live', 'Watch unlimited on demand', 'Watch on any device']}\n              onModal={true}\n              color={productColor.green}\n              showPurchaseButton={false}\n              title={'Game Pass'}\n              price={`${gamePassPriceFormatted}`}\n            />\n          )}\n          {purchaseOption === PurchaseOption.SeasonPass && (\n            <Product\n              description={description}\n              features={['Watch any event live from your selected season', 'Watch unlimited on demand', 'Watch on any device']}\n              onModal={true}\n              color={productColor.green}\n              showPurchaseButton={false}\n              title={'Season Pass'}\n              price={`${seasonPassPriceFormatted}`}\n            />\n          )}\n          {purchaseOption === PurchaseOption.WatchItAll && (\n            <Product\n              description={'Monthly Subscription'}\n              features={[\n                'Watch all events live',\n                'Includes all competitions',\n                'No fixed term contracts',\n                'Watch unlimited on demand',\n                'Watch on any device',\n              ]}\n              onModal={true}\n              color={productColor.green}\n              showPurchaseButton={false}\n              title={'Watch It All'}\n              price={`${watchItAllPriceFormatted} / Month`}\n            />\n          )}\n        </div>\n        <div className={styles['payment-new__payment-details']}>\n          <p className={styles['payment-new__header']}>Payment details</p>\n          <form onSubmit={handleSubmit2} className={styles['payment-new__form']}>\n            <p>\n              <Input data={nameOnCard} placeholder=\"Name on card\" label=\"cardName\" type=\"text\" required />\n            </p>\n            {\n              <div className={styles['payment-new__form-group']}>\n                <p>\n                  <CardNumberElement\n                    id=\"cardNumber\"\n                    className={styles['payment-new__input']}\n                    /*onBlur={() => console.log('CardCvcElement blur')}\n                                        onChange={() => console.log('CardCvcElement change')}\n                                        onFocus={() => console.log('CardCvcElement focus')}\n                                        onReady={() => console.log('CardCvcElement ready')}*/\n                    options={{ ...ELEMENT_OPTIONS, placeholder: 'Credit card number ' }}\n                  />\n                </p>\n                <p>\n                  <CardExpiryElement\n                    id=\"expiry\"\n                    className={styles['payment-new__input']}\n                    /*onBlur={() => console.log('CardExpiryElement blur')}\n                                        onChange={() => console.log('CardExpiryElement change')}\n                                        onFocus={() => console.log('CardExpiryElement focus')}\n                                        onReady={() => console.log('CardExpiryElement ready')}*/\n                    options={{ ...ELEMENT_OPTIONS, placeholder: 'Expiry date' }}\n                  />\n                </p>\n                <p>\n                  <CardCvcElement\n                    id=\"cvc\"\n                    className={styles['payment-new__input']}\n                    /*onBlur={() => console.log('CardCvcElement blur')}\n                                        onChange={() => console.log('CardCvcElement change')}\n                                        onFocus={() => console.log('CardCvcElement focus')}\n                                        onReady={() => console.log('CardCvcElement ready')}*/\n                    options={{ ...ELEMENT_OPTIONS, placeholder: 'CVV number' }}\n                  />\n                </p>\n              </div>\n            }\n            {purchaseOption === PurchaseOption.WatchItAll && (\n              <p>\n                <PromoCode data={promoCode} />\n                {/* <Input placeholder=\"Promo code\"  data={promoCode}  label=\"promoCode\" type=\"text\" /> */}\n              </p>\n            )}\n            {(purchaseOption === PurchaseOption.SeasonPass || purchaseOption === PurchaseOption.GamePass) && (\n              <p>\n                <Input placeholder=\"Promo code\" disabled={true} label=\"promoCode\" type=\"text\" />\n              </p>\n            )}\n            <div className={styles['payment-new__total']}>\n              <div>Total</div>\n              <div className=\"text-right\">{total}</div>\n              {purchaseOption === PurchaseOption.WatchItAll && (\n                <>\n                  <div>Next Payment Date</div>\n                  <div className=\"text-right\">{computeTrial}</div>\n                </>\n              )}\n            </div>\n            <p>\n              <Button type=\"submit\" variant=\"secondary\" color=\"success\" label=\"Purchase Plan\" isLoading={isSaving} />\n            </p>\n\n            <div className={styles['payment-new__tos-links']}>\n              <p>\n                By creating an account, you are agreeing to our <Link to=\"/terms-of-service\">Terms</Link> and{' '}\n                <Link to=\"/privacy-policy\">Privacy Policy</Link>.\n              </p>\n            </div>\n          </form>\n        </div>\n      </div>\n      {/* {!isSaving && (\n        <Button\n          className={styles['payment-new__continue-free']}\n          variant=\"secondary\"\n          color=\"ghost-green\"\n          onClick={continueFree}\n          label=\"Continue for Free\"\n        ></Button>\n      )} */}\n    </div>\n  )\n}\n\nexport default PaymentNew\n"]},"metadata":{},"sourceType":"module"}