{"ast":null,"code":"import { from, of, EMPTY } from 'rxjs';\nimport { exhaustMap, filter, catchError } from 'rxjs/operators';\nimport { isActionOf } from 'typesafe-actions';\nimport { tagsSaveTagEvent } from '../events';\nimport Notifications from 'react-notification-system-redux';\nimport { postOrDeleteSavedTags } from '../api/postOrDeleteSavedTags';\n\nvar getErrorNotification = function getErrorNotification(method) {\n  return Notifications.error({\n    title: 'Error',\n    message: \"An error occurred. Tag not \".concat(method.toLocaleLowerCase().replace('delete', 'delet'), \"ed. Please try again.\"),\n    position: 'tc',\n    autoDismiss: 10,\n    action: {\n      label: 'Close',\n      callback: function callback() {\n        return console.log('Notification closed');\n      }\n    }\n  });\n};\n\nvar tagsSaveRequestedEpic = function tagsSaveRequestedEpic(action$, state$) {\n  return action$.pipe(filter(isActionOf(tagsSaveTagEvent)), exhaustMap(function (event) {\n    var tagId = event.payload;\n    var method = 'POST';\n    if (!state$.value.content.tags.savedTagIds.includes(tagId)) method = 'DELETE';\n    return from(postOrDeleteSavedTags(tagId, method)).pipe(exhaustMap(function (apiResponse) {\n      if (apiResponse.is_success) {\n        return EMPTY;\n      }\n\n      return of(getErrorNotification(method));\n    }), catchError(function () {\n      return of(getErrorNotification(method));\n    }));\n  }));\n};\n\nexport default [tagsSaveRequestedEpic];","map":{"version":3,"sources":["/Users/ognjen/Desktop/with-typescript/src/services/content/tags/epics/saveTagRequestedEpic.ts"],"names":["from","of","EMPTY","exhaustMap","filter","catchError","isActionOf","tagsSaveTagEvent","Notifications","postOrDeleteSavedTags","getErrorNotification","method","error","title","message","toLocaleLowerCase","replace","position","autoDismiss","action","label","callback","console","log","tagsSaveRequestedEpic","action$","state$","pipe","event","tagId","payload","value","content","tags","savedTagIds","includes","apiResponse","is_success"],"mappings":"AACA,SAASA,IAAT,EAAeC,EAAf,EAAmBC,KAAnB,QAAgC,MAAhC;AACA,SAASC,UAAT,EAAqBC,MAArB,EAA6BC,UAA7B,QAA+C,gBAA/C;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,gBAAT,QAAiC,WAAjC;AAEA,OAAOC,aAAP,MAA0B,iCAA1B;AACA,SAASC,qBAAT,QAAsC,8BAAtC;;AAEA,IAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACC,MAAD,EAAoB;AAC/C,SAAOH,aAAa,CAACI,KAAd,CACL;AACEC,IAAAA,KAAK,EAAE,OADT;AAEEC,IAAAA,OAAO,uCAAgCH,MAAM,CAACI,iBAAP,GAA2BC,OAA3B,CAAmC,QAAnC,EAA6C,OAA7C,CAAhC,0BAFT;AAGEC,IAAAA,QAAQ,EAAE,IAHZ;AAIEC,IAAAA,WAAW,EAAE,EAJf;AAKEC,IAAAA,MAAM,EAAE;AACNC,MAAAA,KAAK,EAAE,OADD;AAENC,MAAAA,QAAQ,EAAE;AAAA,eAAMC,OAAO,CAACC,GAAR,CAAY,qBAAZ,CAAN;AAAA;AAFJ;AALV,GADK,CAAP;AAYD,CAbD;;AAgBA,IAAMC,qBAAgD,GAAG,SAAnDA,qBAAmD,CAACC,OAAD,EAAUC,MAAV;AAAA,SACvDD,OAAO,CAACE,IAAR,CACEvB,MAAM,CAACE,UAAU,CAACC,gBAAD,CAAX,CADR,EAEEJ,UAAU,CAAC,UAACyB,KAAD,EAAgB;AACzB,QAAMC,KAAa,GAAGD,KAAK,CAACE,OAA5B;AACA,QAAInB,MAAc,GAAG,MAArB;AACA,QAAI,CAACe,MAAM,CAACK,KAAP,CAAaC,OAAb,CAAqBC,IAArB,CAA0BC,WAA1B,CAAsCC,QAAtC,CAA+CN,KAA/C,CAAL,EAA4DlB,MAAM,GAAG,QAAT;AAE5D,WAAOX,IAAI,CAACS,qBAAqB,CAACoB,KAAD,EAAQlB,MAAR,CAAtB,CAAJ,CAA2CgB,IAA3C,CACLxB,UAAU,CAAC,UAAAiC,WAAW,EAAI;AACxB,UAAIA,WAAW,CAACC,UAAhB,EAA4B;AAC1B,eAAOnC,KAAP;AACD;;AAED,aAAOD,EAAE,CAACS,oBAAoB,CAACC,MAAD,CAArB,CAAT;AACD,KANS,CADL,EAQLN,UAAU,CAAC;AAAA,aAAMJ,EAAE,CAACS,oBAAoB,CAACC,MAAD,CAArB,CAAR;AAAA,KAAD,CARL,CAAP;AAUD,GAfS,CAFZ,CADuD;AAAA,CAAzD;;AAqBA,eAAe,CAACa,qBAAD,CAAf","sourcesContent":["import { Epic } from 'redux-observable'\nimport { from, of, EMPTY } from 'rxjs'\nimport { exhaustMap, filter, catchError } from 'rxjs/operators'\nimport { isActionOf } from 'typesafe-actions'\nimport { tagsSaveTagEvent } from '../events'\nimport { RootState } from '../../../RootState'\nimport Notifications from 'react-notification-system-redux'\nimport { postOrDeleteSavedTags } from '../api/postOrDeleteSavedTags'\n\nconst getErrorNotification = (method: string) => {\n  return Notifications.error(\n    {\n      title: 'Error',\n      message: `An error occurred. Tag not ${method.toLocaleLowerCase().replace('delete', 'delet')}ed. Please try again.`,\n      position: 'tc',\n      autoDismiss: 10,\n      action: {\n        label: 'Close',\n        callback: () => console.log('Notification closed')\n      }\n    }\n  )\n}\n\n\nconst tagsSaveRequestedEpic: Epic<any, any, RootState> = (action$, state$) =>\n  action$.pipe(\n    filter(isActionOf(tagsSaveTagEvent)),\n    exhaustMap((event: any) => {\n      const tagId: string = event.payload\n      let method: string = 'POST'\n      if (!state$.value.content.tags.savedTagIds.includes(tagId)) method = 'DELETE'\n\n      return from(postOrDeleteSavedTags(tagId, method)).pipe(\n        exhaustMap(apiResponse => {\n          if (apiResponse.is_success) {\n            return EMPTY\n          }\n\n          return of(getErrorNotification(method))\n        }),\n        catchError(() => of(getErrorNotification(method)))\n      )\n    })\n  )\n\nexport default [tagsSaveRequestedEpic]\n"]},"metadata":{},"sourceType":"module"}