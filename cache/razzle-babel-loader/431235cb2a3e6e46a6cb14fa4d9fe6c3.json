{"ast":null,"code":"import { ofType } from 'redux-observable';\nimport { EMPTY, of } from 'rxjs';\nimport { mergeMap } from 'rxjs/operators';\nimport { selectMainTag } from '../../content/tags/selectors';\nimport { createAction } from 'typesafe-actions';\nconst pageVisited = createAction('PAGE_VISITED', resolve => response => resolve(response));\n\nconst gtmPromoterPushEpic = (action$, state$) => action$.pipe(ofType('PAGE_INITIALIZED'), mergeMap(event => {\n  const mainTag = selectMainTag(state$.value);\n  const visited = state$.value.content.tags.visitedTags;\n  const data = {\n    promoterId: mainTag === null || mainTag === void 0 ? void 0 : mainTag.id,\n    eventName: mainTag === null || mainTag === void 0 ? void 0 : mainTag.name\n  };\n\n  if (mainTag !== undefined && (visited === null || visited === void 0 ? void 0 : visited.filter(o => o.promoterId === (mainTag === null || mainTag === void 0 ? void 0 : mainTag.id) && o.eventName === (mainTag === null || mainTag === void 0 ? void 0 : mainTag.name)).length) === 0) {\n    window.dataLayer.push(data);\n    return of(pageVisited(data));\n  }\n\n  return EMPTY;\n}));\n\nexport default [gtmPromoterPushEpic];","map":{"version":3,"sources":["/Users/ognjen/Desktop/spooky-live-ssr/ui/src/services/shared/epics/gtmPromoterPushEpic.ts"],"names":["ofType","EMPTY","of","mergeMap","selectMainTag","createAction","pageVisited","resolve","response","gtmPromoterPushEpic","action$","state$","pipe","event","mainTag","value","visited","content","tags","visitedTags","data","promoterId","id","eventName","name","undefined","filter","o","length","window","dataLayer","push"],"mappings":"AAAA,SAAeA,MAAf,QAA6B,kBAA7B;AACA,SAASC,KAAT,EAAgBC,EAAhB,QAA0B,MAA1B;AACA,SAASC,QAAT,QAA8C,gBAA9C;AAGA,SAASC,aAAT,QAA8B,8BAA9B;AAEA,SAASC,YAAT,QAA6B,kBAA7B;AAGA,MAAMC,WAAW,GAAGD,YAAY,CAAC,cAAD,EAAkBE,OAAD,IAAcC,QAAD,IAC5DD,OAAO,CAACC,QAAD,CADuB,CAAhC;;AAIA,MAAMC,mBAAmD,GAAG,CAACC,OAAD,EAAUC,MAAV,KAC1DD,OAAO,CAACE,IAAR,CACEZ,MAAM,CAAC,kBAAD,CADR,EAEEG,QAAQ,CAACU,KAAK,IAAI;AAChB,QAAMC,OAAwB,GAAGV,aAAa,CAACO,MAAM,CAACI,KAAR,CAA9C;AACA,QAAMC,OAAO,GAAGL,MAAM,CAACI,KAAP,CAAaE,OAAb,CAAqBC,IAArB,CAA0BC,WAA1C;AACA,QAAMC,IAAI,GAAG;AACXC,IAAAA,UAAU,EAAEP,OAAF,aAAEA,OAAF,uBAAEA,OAAO,CAAEQ,EADV;AAEXC,IAAAA,SAAS,EAAET,OAAF,aAAEA,OAAF,uBAAEA,OAAO,CAAEU;AAFT,GAAb;;AAIA,MAAIV,OAAO,KAAGW,SAAV,IACF,CAAAT,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEU,MAAT,CAAgBC,CAAC,IAAIA,CAAC,CAACN,UAAF,MAAiBP,OAAjB,aAAiBA,OAAjB,uBAAiBA,OAAO,CAAEQ,EAA1B,KAAgCK,CAAC,CAACJ,SAAF,MAAgBT,OAAhB,aAAgBA,OAAhB,uBAAgBA,OAAO,CAAEU,IAAzB,CAArD,EAAoFI,MAApF,MAA+F,CADjG,EACoG;AACjGC,IAAAA,MAAD,CAAgBC,SAAhB,CAA0BC,IAA1B,CAA+BX,IAA/B;AACA,WAAOlB,EAAE,CAAEI,WAAW,CAACc,IAAD,CAAb,CAAT;AACD;;AACD,SAAOnB,KAAP;AAED,CAdO,CAFV,CADF;;AAoBA,eAAe,CAACQ,mBAAD,CAAf","sourcesContent":["import { Epic, ofType } from 'redux-observable'\nimport { EMPTY, of } from 'rxjs'\nimport { mergeMap, tap, withLatestFrom } from 'rxjs/operators'\n\nimport { RootState } from '../../RootState'\nimport { selectMainTag } from '../../content/tags/selectors'\nimport { ITag } from '../../content/tags/models'\nimport { createAction } from 'typesafe-actions'\n\n\nconst pageVisited = createAction('PAGE_VISITED', (resolve) => (response: any) =>\n  resolve(response)\n)\n\nconst gtmPromoterPushEpic: Epic<any, any, RootState, any> = (action$, state$) =>\n  action$.pipe(\n    ofType('PAGE_INITIALIZED'),\n    mergeMap(event => {\n      const mainTag:ITag | undefined = selectMainTag(state$.value);\n      const visited = state$.value.content.tags.visitedTags;\n      const data = {\n        promoterId: mainTag?.id,\n        eventName: mainTag?.name\n      };\n      if (mainTag!==undefined && \n        visited?.filter(o => o.promoterId === mainTag?.id && o.eventName === mainTag?.name).length === 0) {\n        (window as any).dataLayer.push(data);\n        return of (pageVisited(data));\n      }\n      return EMPTY;\n      \n    })\n  )\n\nexport default [gtmPromoterPushEpic]\n\n"]},"metadata":{},"sourceType":"module"}